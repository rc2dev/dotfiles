# vim:ft=zsh
#
# Shell aliases
#
# Author: Rafael Cavalcanti <https://rafaelc.org/dev>

# List files when cd'ing
cd() { builtin cd "$@" && eval "ls"; }

# Also check command after sudo for alias (see man bash)
alias sudo="sudo "
alias watch="watch "

# Increase verbosity and prompt before overwriting (for rm, prompt
# before removing directory or more than 3 files)
alias cp="cp -vir"
alias mv="mv -vi"
alias rm="rm -vI"
alias ln="ln -vi"
alias chmod="chmod -v"
alias chown="chown -v"
alias mkdir="mkdir -v"

# Human-readable output
alias df="df -h"
alias free="free -h"

# Coloured output
alias grep="grep --color=auto"

# Accept color escape sequences
alias less="less -R"

# ls
if command -v exa > /dev/null; then
	alias ls="exa --color=auto -aF --group-directories-first"
	alias ll="ls -l --git"
else
	alias ls="ls --color=auto -AF --group-directories-first"
	alias ll="ls -lh"
fi

# Shell history
# Show history timestamped
alias history="history -i"
# Copy commands from history to clipboard
# The awk command removes duplicates, or fzf may be full of them.
alias hy="
	fc -ln 0 |
	awk '!a[\$0]++' |
	fzf --tac --no-preview --height 90% |
	xclip -selection clipboard
"

# Shell
alias ..="cd .."
alias c="clear"
alias q="exit"
alias x="exit"
take() {
	if ! mkdir -p "$@"; then
		echo "Retrying with sudo..."
		sudo mkdir -p "$@"
	fi && cd ${@:$#}
}

# Edit
alias e="$EDITOR"
alias ef="nvim +Rg"
alias ep="nvim +Files"
alias et="nvim +History"
# Don't use `ye`, since vim-plug operations fail with those variables set.
alias ev="e ~/.config/nvim/init.vim"
alias ey="ye"
alias vim="nvim"

# Create a backup of a file
bak() {
	if [[ "$(stat --format '%u' "$1")" == "$UID" ]]; then
		cp "$1"{,.bak}
	else
		sudo cp "$1"{,.bak}
	fi
}

# Easier commands
alias fbl="find . -xtype l"  # Find broken links
alias cx="chmod +x"
alias ex="atool --extract --each --"
alias f="ranger"
alias fn="find . -iname"
alias hs="python3 -m http.server"  # HTTP server
keys() {
	xev | awk -F'[ )]+' '/^KeyPress/ { a[NR+2] } NR in a { printf "%-3s %s\n", $5, $8 }'
}
alias n="notes"
alias nn="notes name"
alias o="xdg-open"
alias reb="reboot || { echo 'Trying sudo...'; sudo reboot; }"
alias s="ssh"
alias se="sudo -e"
alias yts="yt-dlp --all-subs --skip-download"  # Download only subtitles

# Set default options
alias fd="fd $FD_ARGS"
# Set fixed port because of firewall
alias go-chromecast="go-chromecast --first --server-port 39951"
alias spotdl="spotdl --output-format m4a"

# Git
alias g="git"
alias ga="git add"
alias gai="git add -i"
alias gau="git add -u"
alias gc="git commit -v"
alias gc!="git commit -v --amend"
alias gca="git commit -v --all"
alias gca!="git commit -v --all --amend"
alias gcp="git cherry-pick"
alias gco="git checkout"
alias gd="git diff"
gfr() { git fetch && git reset --hard origin/$(git rev-parse --abbrev-ref HEAD); }
alias gl="git pull"
alias glo="git log --all --graph --pretty=format:'%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(dim white)- %an%C(reset)%C(bold yellow)%d%C(reset)%n'"
alias glon="glo --name-only"
alias gp="git push"
alias gpf="git push --force-with-lease"
alias grb="git rebase"
alias grba="git rebase --abort"
alias grbc="git rebase --continue"
alias grbi="git rebase --interactive"
alias gsa="git stash"
alias gsh="git show"
alias gst="git status"

# dotfiles
alias y="dotfiles"
alias ya="y add"
alias yai="y add -i"
alias yau="y add -u"
alias yc="y commit -v"
alias yc!="y commit -v --amend"
alias yca="y commit -v --all"
alias ycp="y cherry-pick"
alias yco="y checkout"
alias yd="y diff"
alias yl="y pull"
alias ylo="y log --all --graph --pretty=format:'%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(dim white)- %an%C(reset)%C(bold yellow)%d%C(reset)%n'"
alias ylon="ylo --name-only"
alias yp="y push"
alias ypf="y push --force"
alias yrb="y rebase"
alias yrba="y rebase --abort"
alias yrbc="y rebase --continue"
alias yrbi="y rebase --interactive"
alias ysh="y show"
alias yst="y status"
alias ye="dotfiles cmd nvim +GFiles"

# Use bat if available
command -v bat >/dev/null && alias cat="bat"

# Docker: quickly start an interactive container
alias doq="docker run -it --rm -v ~/Downloads:/share"

# systemctl, journalctl
alias sc="sudo systemctl"
alias scu="systemctl --user"
alias scdr="sudo systemctl daemon-reload"
alias scudr="systemctl --user daemon-reload"
alias scr="sudo systemctl restart"
alias scs="systemctl status"
alias jc="journalctl"

# APT
alias aar="sudo apt autoremove --purge --yes"
alias ah="apt search"
alias ama="sudo apt-mark auto"
alias amm="sudo apt-mark manual"
alias ai="sudo apt install"
alias ap="sudo apt purge"
alias au="sudo apt update"
alias afu="sudo apt update && sudo apt full-upgrade"
alias aw="apt show"

# dnf
alias dhh="dnf history | head"
alias dhu="sudo dnf history undo"

# Only supported by zsh
if [[ -n "$ZSH_VERSION" ]]; then
	# Global aliases
	alias -g G="| grep"
	alias -g L="| less"
fi

# Source jumping aliases
[[ ! -e "$ZDOTDIR/jumps_auto" ]] && gen-jumps
source "$ZDOTDIR/jumps_auto"
