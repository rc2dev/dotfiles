# vim:ft=zsh
#
# Shell aliases
#
# Author: Rafael Cavalcanti <https://rafaelc.org/dev>

# List files when cd'ing
cd() { builtin cd "$@" && eval "ls"; }

# Also check command after sudo for alias (see man bash)
alias sudo="sudo "
alias watch="watch "

# Increase verbosity and prompt before overwriting (for rm, prompt
# before removing directory or more than 3 files)
alias cp="cp -vi"
alias mv="mv -vi"
alias rm="rm -vI"
alias ln="ln -vi"
alias chmod="chmod -v"
alias chown="chown -v"
alias mkdir="mkdir -v"

# Human-readable output
alias df="df -h"
alias free="free -h"

# Coloured output
alias diff="diff --color=auto"
alias grep="grep --color=auto"

# Accept color escape sequences
alias less="less -R"

# ls
if command -v exa > /dev/null; then
  alias ls="exa --color=auto -aaF --group-directories-first"
  alias ll="ls -lg --git"
else
  alias ls="ls --color=auto -aF --group-directories-first"
  alias ll="ls -lh"
fi

# Shell history
# Show history timestamped
alias history="history -i"
# Copy commands from history to clipboard
# The awk command removes duplicates, or fzf may be full of them.
alias hy="
  fc -ln 0 |
  awk '!a[\$0]++' |
  fzf --tac --no-preview --height 90% |
  xsel --clipboard
"

# Shell
alias q="exit"

# Edit
alias e="$EDITOR"
alias v="nvim"
alias vim="nvim"

# mkdir and cd to dir
take() {
  if ! mkdir -pv "$@"; then
    echo "Retrying with sudo..."
    sudo mkdir -pv "$@"
  fi && cd ${@:$#}
}

# Create a backup of a file
bak() {
  if [[ "$(stat --format '%u' "$1")" == "$UID" ]]; then
    cp "$1"{,.bak}
  else
    sudo cp "$1"{,.bak}
  fi
}

# Easier commands
alias cx="chmod +x"
alias ex="atool --extract --each --"
alias fn="find . -iname"
keys() {
  xev | awk -F'[ )]+' '/^KeyPress/ { a[NR+2] } NR in a { printf "%-3s %s\n", $5, $8 }'
}
alias r="ranger"
alias reb="systemctl reboot"
alias s="ssh"
alias se="sudo -e"

# Git
alias g="git"
alias ga="git add"
alias gai="git add -i"
alias gau="git add -u"
alias gc="git commit -v"
alias gc!="git commit -v --amend"
alias gcl="git clone"
alias gco="git checkout"
alias gd="git diff"
alias gl="git pull"
alias glo="git log --all --graph --pretty=format:'%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(dim white)- %an%C(reset)%C(bold yellow)%d%C(reset)%n'"
alias gp="git push"
alias gpf="git push --force-with-lease"
alias grb="git rebase"
alias grba="git rebase --abort"
alias grbc="git rebase --continue"
alias grbi="git rebase --interactive"
alias gsh="git show"
alias gst="git status"

# dotfiles
alias y="dotfiles"
alias ya="y add"
alias yai="y add -i"
alias yau="y add -u"
alias yc="y commit -v"
alias yc!="y commit -v --amend"
alias yco="y checkout"
alias yd="y diff"
alias yl="y pull"
alias ylo="y log --all --graph --pretty=format:'%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(dim white)- %an%C(reset)%C(bold yellow)%d%C(reset)%n'"
alias yp="y push"
alias ypf="y push --force"
alias yrb="y rebase"
alias yrba="y rebase --abort"
alias yrbc="y rebase --continue"
alias yrbi="y rebase --interactive"
alias ysh="y show"
alias yst="y status"
alias yh="dotfiles cmd gh"
alias ytig="dotfiles cmd tig"

# Use bat if available
if command -v bat >/dev/null; then
  alias cat="bat"
elif command -v batcat >/dev/null; then
  alias cat="batcat"
fi

# systemctl, journalctl
alias sc="sudo systemctl"
alias scu="systemctl --user"
alias scdr="sudo systemctl daemon-reload"
alias scudr="systemctl --user daemon-reload"
alias scr="sudo systemctl restart"
alias scs="systemctl status"
alias jc="journalctl"

# APT
alias aar="sudo apt autoremove --purge"
alias ama="sudo apt-mark auto"
alias amm="sudo apt-mark manual"

# dnf
alias dhh="dnf history | head -15"
alias dhr="sudo dnf history rollback"
alias dhu="sudo dnf history undo"

# Only supported by zsh
if [[ -n "$ZSH_VERSION" ]]; then
  # Global aliases
  alias -g G="| grep"
  alias -g L="| less"
fi

# Source jumping aliases
[[ ! -e "$HOME/.cache/gen-jumps/shell" ]] && gen-jumps
source "$HOME/.cache/gen-jumps/shell"
