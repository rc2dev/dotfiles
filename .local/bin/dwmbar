#!/usr/bin/env bash
#
# Copyright (C) 2020 Rafael Cavalcanti - rafaelc.org
# Licensed under GPLv3

if [[ "$(pulsemixer --get-mute)" == "1" ]]; then
  vol_icon="ğŸ”‡"
else
  vol_icon="ğŸ”Š"
fi
bar_vol="${vol_icon} $(pulsemixer --get-volume | cut -f 1 -d ' ')%"

player_cmd="playerctl --player=%any,chromium"
player_status="$($player_cmd status)"
if [[ "$player_status" =~ (Playing|Paused) ]]; then
  case $player_status in
    Playing) player_icon=ï‹;;
    Paused) player_icon=ïŒ;;
  esac
  # Calling metadata with --format prevents mixing multiple players
  artist="$($player_cmd metadata --format "{{ artist }}")"
  title="$($player_cmd metadata --format "{{ title }}")"
  bar_player="${player_icon} ${artist:+$artist -} ${title}"
fi

bar_date="$(date +"%a, %b %e")"
bar_time="ğŸ• $(date +"%R")"
bar_mem="Mem: $(free -h | grep '^Mem' | awk '{print $3}')"

xsetroot -name " ${bar_player:+$bar_player |} ${bar_mem} | ${bar_vol} | ${bar_date} | ${bar_time} "
