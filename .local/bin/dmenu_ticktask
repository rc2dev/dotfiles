#!/usr/bin/env bash
#
# dmenu script for running ticktask.
#
# Copyright (C) 2023 Rafael Cavalcanti <https://rafaelc.org/dev>
# Licensed under GPLv3

set -euo pipefail
readonly dmenu="${DMENU:-dmenu}"
declare -ar rofi_opts=(-theme-str "window { width: 900px; height: 0; location: center; anchor: center; border: 2px; border-color: @fg-alt; border-radius: 8px; }")

if [[ $dmenu =~ ^rofi ]]; then
  launcher_opts=("${rofi_opts[@]}")
else
  launcher_opts=()
fi

readonly task="$($dmenu "${launcher_opts[@]}" -l 0 -p "Add to TickTick")"
if [[ -z "$task" ]]; then
  exit 0
fi

if ticktask "$task"; then
  notify-send "TickTask" --icon checkbox "Sent."
else
  notify-send "TickTask" --icon checkbox --urgency critical "Not sent."
fi
