#!/usr/bin/env bash
#
# virt-viewer helper:
# - Always use --attach.
# - Easily connect to session QEMU and remote QEMU.
#
# Author: Rafael Cavalcanti <https://rafaelc.org/dev>

readonly bin="virt-viewer"

if ! command -v "$bin" > /dev/null; then
  zenity --error --text "virt-viewer is not installed."
  exit 1
fi

readonly chosen="$(zenity \
  --list \
  --title="Options for virt-viewer" \
  --text="Connect to..." \
  --column="0" \
  "session" "system" "rd-system" \
  --width=100 \
  --hide-header \
)"

if [[ -z "$chosen" ]]; then
  exit
fi

case "$chosen" in
  session) uri="qemu:///session" ;;
  system) uri="qemu:///system" ;;
  rd-system) uri="qemu+ssh://rd/system" ;;
esac

exec "$bin" --connect="$uri" --attach "$@"

