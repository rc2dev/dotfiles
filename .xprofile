# ~/.xprofile
#
# Startup commands for dwm
#
# Author: Rafael Cavalcanti <https://rafaelc.org/dev>

source $HOME/.zprofile
xrdb $XRESOURCES

if [ "$XDG_SESSION_DESKTOP" != "dwm" ]; then
  return 0
fi

# Gnome Keyring
if ! pgrep -u "$USER" gnome-keyring-daemon > /dev/null; then
  eval $(gnome-keyring-daemon --start)
  export SSH_AUTH_SOCK
fi

# Polkit agent - so GUI applications can request privileges
lxpolkit &

# Basic utilities
xsettingsd &
remap-kb &
sxhkd &
dunst &
nitrogen --restore &
redshift-gtk &
compton &
clipmenud &
nm-applet &
system-config-printer-applet &
syncthing-gtk --minimized &
keepassxc &

# rd specific
if [ "$HOST" = "rd" ]; then
  # If -f is not passed, mouse over dwmbar has the same behaviour
  # as it was over the focused window.
  imwheel -b "4 5" -f &

  # Automatically lock and suspend after idle
  xidlehook \
    --detect-sleep \
    --not-when-fullscreen \
    --not-when-audio \
    --socket "$XIDLEHOOK_SOCK" \
    --timer 120 'slock' '' \
    --timer 900 'systemctl suspend' '' \
    &

  kdeconnect-indicator &
fi

# Statusbar loop
while true; do
  dwmbar
  sleep 10s
done &
